@page "/Competitions"
@page "/Competition"
@inject BrewCompDbContext DBContext

<MudStack Spacing=2>
    <div><h3>Competitions</h3></div>
    <MudDataGrid Items=@DBContext.Competitions Filterable=true ReadOnly=@_readOnly EditMode=@DataGridEditMode.Form RowsPerPage="25">
        <Columns>
            <HierarchyColumn T=Competition/>
            <PropertyColumn Property="c=>c.Name" Title="Competition Name"/>
            <TemplateColumn Title="Entries">
                <CellTemplate>
                    @(context.Item.Entries.Count == 0 ? "None" : context.Item.Entries.Count)
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Entry Limit">
                <CellTemplate>
                    @(context.Item.EntryLimit == null || context.Item.EntryLimit <= 0 ? "No Entry Limit" : context.Item.EntryLimit)
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="c=>c.EntryCost" Format="C"/>
            <PropertyColumn Property="c=>c.CompetitionDates.StartDate" Format="yyyy-mm-dd" Title="Start Date"/>
        </Columns>
        <ChildRowContent>
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">@context.Item.Name</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <div>Extra Comp Details will appear here</div>
                </MudCardContent>
            </MudCard>
        </ChildRowContent>
        <PagerContent>
            <MudDataGridPager T="Competition"/>
        </PagerContent>
    </MudDataGrid>
</MudStack>


@code {
    private bool _readOnly = false;
    private AddCompModal? addCompModal = default!;

    private async Task RemoveComp(Competition comp)
    {
        DBContext.Remove(comp);
        await DBContext.SaveChangesAsync();
    }

}
